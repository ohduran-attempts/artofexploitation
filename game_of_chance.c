#include <stdio.h>
#include <string.h>
#include <fcntl.h>
#include <sys/stat.h>
#include <stdlib.h>
#include "hacking.h"

#ifndef DATAFILE
#define DATAFILE "/var/chance.data"  // File to store user data
#endif


// User struct
struct user{
  int uid;
  int credits;
  int highscore;
  char name[100];
  int (*current_game)();
}

// function prototypes
int get_player_data();
void register_new_player();
void update_player_data();
void show_highscore();
void jackpot();
void input_name();
void print_cards(char *, char *, int);
int take_wager(int, int);
void play_the_game();
int pick_a_number();
int dealer_no_match();
int find_the_ace();
void fata(char *);


// global variables
struct user player;

int main(int argc, char const *argv[]) {
  int choice, last_game;

  srand(time(0)); // Seed the randomize with the current time

  // Log in new player if not found
  if(get_player_data() == -1){
    register_new_player();
  }

  while (choice != 7) {
    printf("-=[ Game of Chance Menu]=-\n");
    printf("1 - Play the Pick a Number game\n");
    printf("2 - Play the No Match Dealer game\n");
    printf("1 - Play the Find the Ace game\n");
    printf("1 - View current high score\n");
    printf("1 - Change your user name\n");
    printf("1 - Reset your account at 100 credits\n");
    printf("1 - Quit\n");
    printf("[Name: %s]\n", player.name);
    printf("[You have %u credits]\n", player.credits);


    scanf("%d", &choice);

    // Invalid
    if((choice < 1) || (choice > 7)){
      printf("\n[!!] The number %d is an invalid selection.\n\n", choice);
    }

    // Games
    else if (choice < 4){
      if (choice != last_game) {
        if (choice == 1){
          player.current_game = pick_a_number;
        }
        else if (choice == 2){
          player.current_game = dealer_no_match;
        }
        else {
          player.current_game = find_the_ace;
        }
        last_game = choice;
      }
      play_the_game();
    }


  }
}
